<!DOCTYPE HTML>
<!--
	Hyperspace by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Making Refraction</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Header -->
			<header id="header">
				<a href="index.html" class="title"></a>
				<nav>
					<ul>
						<li><a href="refraction_page.html" class="active">Refraction</a></li>
						<li><a href="elements.html">Elements</a></li>
					</ul>
				</nav>
			</header>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<section id="main" class="wrapper">
						<div class="inner">
							<h1 class="major">Making Refraction</h1>
							<span class="image fit"><img src="images/LightingShowcase.gif" alt="" /></span>
							<p>
								One of my favorite and most challenging projects to date is Refraction. A fast CPU-based lighting engine and renderer. Due to it being CPU-based, I had to do a lot of lowÂ 
								level optimization. While looking at the memory used, I realized that it was very cache incoherent. In order to fix this
								I made my own custom datatype for colors. This allowed them to be as small as possible so they could fit in the cache. Another optimization I did was multi-threading the lighting calculations.
								With threads able to take a set of pixels and solve them in parallel, the program ran much more efficiently.<br />

								<h3>How it works:</h3>
								<ol>
									<li>All objects and tilesets are merged together into one image (the normal maps are also merged into a separate image).</li>
									<li>For each light, we then go over each pixel in its range and calculate the light's strength, using the normal map to factor in the surface normal.</li>
									<li>The individual lights strengths are added together, resulting in the total brightness.</li>
									<li>We then apply any post-processing effects, like dithering and scanlines.</li>
								</ol>

								<h3>Code Sample</h3>
								<pre><code>
    &lt;span style='color:#004a43; '&gt;#&lt;/span&gt;&lt;span style='color:#004a43; '&gt;DEFINE DEGREES_TO_RADIANS 0&lt;/span&gt;&lt;span style='color:#308080; '&gt;.&lt;/span&gt;&lt;span style='color:#004a43; '&gt;01745329f &lt;/span&gt;&lt;span style='color:#595979; '&gt;//Precomputed degrees to radians conversion ratio&lt;/span&gt;
    &lt;span style='color:#004a43; '&gt;#&lt;/span&gt;&lt;span style='color:#004a43; '&gt;DEFINE ONE_OVER_255 0&lt;/span&gt;&lt;span style='color:#308080; '&gt;.&lt;/span&gt;&lt;span style='color:#004a43; '&gt;00392156f &lt;/span&gt;&lt;span style='color:#595979; '&gt;//Precompute 1 / 255 for conversion from 0 - 255 into 0 - 1&lt;/span&gt;


    &lt;span style='color:#595979; '&gt;//calculate the given lightsource's effect on the current pixel&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; Renderer&lt;span style='color:#406080; '&gt;::&lt;/span&gt;FindPixelLuminosity&lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; x&lt;span style='color:#308080; '&gt;,&lt;/span&gt; &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; y&lt;span style='color:#308080; '&gt;,&lt;/span&gt; Light&lt;span style='color:#308080; '&gt;*&lt;/span&gt; lightSource&lt;span style='color:#308080; '&gt;)&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; normalMin &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008000; '&gt;0.75&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    Vector2 lightP &lt;span style='color:#308080; '&gt;=&lt;/span&gt; lightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;position &lt;span style='color:#308080; '&gt;-&lt;/span&gt; CameraP&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; result &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008000; '&gt;0.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#595979; '&gt;//Determine which algorithm to use based on lightsource type&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;switch&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;lightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;Type&lt;span style='color:#308080; '&gt;)&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;case &lt;/span&gt;&lt;span style='color:#7d0045; '&gt;LightSourceType_Point&lt;/span&gt;&lt;span style='color:#e34adc; '&gt;:&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    Vector2 dist &lt;span style='color:#308080; '&gt;=&lt;/span&gt; Vector2&lt;span style='color:#308080; '&gt;(&lt;/span&gt;x&lt;span style='color:#308080; '&gt;,&lt;/span&gt; y&lt;span style='color:#308080; '&gt;)&lt;/span&gt; &lt;span style='color:#308080; '&gt;-&lt;/span&gt; lightP&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; distFromConeCenter &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#003060; '&gt;sqrt&lt;/span&gt;&lt;span style='color:#308080; '&gt;(&lt;/span&gt;Vector2&lt;span style='color:#406080; '&gt;::&lt;/span&gt;DotProduct&lt;span style='color:#308080; '&gt;(&lt;/span&gt;dist&lt;span style='color:#308080; '&gt;,&lt;/span&gt; dist&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt; &lt;span style='color:#308080; '&gt;/&lt;/span&gt; lightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;radius&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#595979; '&gt;//if the current pixel is outside the lights radius&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;if&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;distFromConeCenter &lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;&lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008000; '&gt;1.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;return&lt;/span&gt; &lt;span style='color:#008000; '&gt;0.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; distFromConeCenterSquared &lt;span style='color:#308080; '&gt;=&lt;/span&gt; distFromConeCenter &lt;span style='color:#308080; '&gt;*&lt;/span&gt; distFromConeCenter&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    result &lt;span style='color:#308080; '&gt;=&lt;/span&gt; lightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;intensity &lt;span style='color:#308080; '&gt;*&lt;/span&gt; &lt;span style='color:#003060; '&gt;pow&lt;/span&gt;&lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#008c00; '&gt;1&lt;/span&gt; &lt;span style='color:#308080; '&gt;-&lt;/span&gt; distFromConeCenterSquared&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;,&lt;/span&gt; &lt;span style='color:#008c00; '&gt;2&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt; &lt;span style='color:#308080; '&gt;/&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#008c00; '&gt;1&lt;/span&gt; &lt;span style='color:#308080; '&gt;+&lt;/span&gt; lightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;radialFalloff &lt;span style='color:#308080; '&gt;*&lt;/span&gt; distFromConeCenter&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt; &lt;span style='color:#200080; font-weight:bold; '&gt;break&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#200080; font-weight:bold; '&gt;case &lt;/span&gt;&lt;span style='color:#7d0045; '&gt;LightSourceType_Directional&lt;/span&gt;&lt;span style='color:#e34adc; '&gt;:&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    &lt;span style='color:#595979; '&gt;//convert angle from degrees to radians&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; AngleRadians &lt;span style='color:#308080; '&gt;=&lt;/span&gt; DEGREES_TO_RADIANS &lt;span style='color:#308080; '&gt;*&lt;/span&gt; &lt;span style='color:#308080; '&gt;-&lt;/span&gt;lightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;angle&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; MinAngleRadians &lt;span style='color:#308080; '&gt;=&lt;/span&gt; DEGREES_TO_RADIANS &lt;span style='color:#308080; '&gt;*&lt;/span&gt; &lt;span style='color:#308080; '&gt;-&lt;/span&gt;lightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;minAngle&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; MaxAngleRadians &lt;span style='color:#308080; '&gt;=&lt;/span&gt; DEGREES_TO_RADIANS &lt;span style='color:#308080; '&gt;*&lt;/span&gt; &lt;span style='color:#308080; '&gt;-&lt;/span&gt;lightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;maxAngle&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#595979; '&gt;//find edges of the viewcone&lt;/span&gt;
    Vector2 FrustumLeftEdge &lt;span style='color:#308080; '&gt;=&lt;/span&gt; Vector2&lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#308080; '&gt;-&lt;/span&gt;sinf&lt;span style='color:#308080; '&gt;(&lt;/span&gt;MinAngleRadians&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;,&lt;/span&gt; cosf&lt;span style='color:#308080; '&gt;(&lt;/span&gt;MinAngleRadians&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    Vector2 FrustumRightEdge &lt;span style='color:#308080; '&gt;=&lt;/span&gt; Vector2&lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#308080; '&gt;-&lt;/span&gt;sinf&lt;span style='color:#308080; '&gt;(&lt;/span&gt;MaxAngleRadians&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;,&lt;/span&gt; cosf&lt;span style='color:#308080; '&gt;(&lt;/span&gt;MaxAngleRadians&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; dRadius &lt;span style='color:#308080; '&gt;=&lt;/span&gt; Vector2&lt;span style='color:#406080; '&gt;::&lt;/span&gt;Length&lt;span style='color:#308080; '&gt;(&lt;/span&gt;FrustumRightEdge &lt;span style='color:#308080; '&gt;-&lt;/span&gt; FrustumLeftEdge&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#595979; '&gt;//find the viewcones direction and tangent lines&lt;/span&gt;
    Vector2 EmissionDirection &lt;span style='color:#308080; '&gt;=&lt;/span&gt; Vector2&lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#308080; '&gt;-&lt;/span&gt;sinf&lt;span style='color:#308080; '&gt;(&lt;/span&gt;AngleRadians&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;,&lt;/span&gt; cosf&lt;span style='color:#308080; '&gt;(&lt;/span&gt;AngleRadians&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    Vector2 EmissionTangent &lt;span style='color:#308080; '&gt;=&lt;/span&gt; Vector2&lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#308080; '&gt;-&lt;/span&gt;EmissionDirection&lt;span style='color:#308080; '&gt;.&lt;/span&gt;y&lt;span style='color:#308080; '&gt;,&lt;/span&gt; EmissionDirection&lt;span style='color:#308080; '&gt;.&lt;/span&gt;x&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    Vector2 ToPixel &lt;span style='color:#308080; '&gt;=&lt;/span&gt; Vector2&lt;span style='color:#308080; '&gt;(&lt;/span&gt;x&lt;span style='color:#308080; '&gt;,&lt;/span&gt; y&lt;span style='color:#308080; '&gt;)&lt;/span&gt; &lt;span style='color:#308080; '&gt;-&lt;/span&gt; lightP&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#595979; '&gt;//find and check if current pixel is inside the lights viewcone&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; Dot &lt;span style='color:#308080; '&gt;=&lt;/span&gt; Vector2&lt;span style='color:#406080; '&gt;::&lt;/span&gt;DotProduct&lt;span style='color:#308080; '&gt;(&lt;/span&gt;ToPixel&lt;span style='color:#308080; '&gt;,&lt;/span&gt; EmissionDirection&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;if&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;Dot &lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt; &lt;span style='color:#008000; '&gt;0.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; distanceSq &lt;span style='color:#308080; '&gt;=&lt;/span&gt; Vector2&lt;span style='color:#406080; '&gt;::&lt;/span&gt;DotProduct&lt;span style='color:#308080; '&gt;(&lt;/span&gt;ToPixel&lt;span style='color:#308080; '&gt;,&lt;/span&gt; ToPixel&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; radius &lt;span style='color:#308080; '&gt;=&lt;/span&gt; Dot &lt;span style='color:#308080; '&gt;*&lt;/span&gt; dRadius&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; distance &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#003060; '&gt;sqrt&lt;/span&gt;&lt;span style='color:#308080; '&gt;(&lt;/span&gt;distanceSq&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; s &lt;span style='color:#308080; '&gt;=&lt;/span&gt; distance &lt;span style='color:#308080; '&gt;/&lt;/span&gt; lightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;radius&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#595979; '&gt;//leave early if the current pixel is outside the light sources radius&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;if&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;s &lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;&lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008000; '&gt;1.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;return&lt;/span&gt; &lt;span style='color:#008000; '&gt;0.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; s2 &lt;span style='color:#308080; '&gt;=&lt;/span&gt; s &lt;span style='color:#308080; '&gt;*&lt;/span&gt; s&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; emitterDistance &lt;span style='color:#308080; '&gt;=&lt;/span&gt; lightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;intensity &lt;span style='color:#308080; '&gt;*&lt;/span&gt; &lt;span style='color:#003060; '&gt;pow&lt;/span&gt;&lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#008c00; '&gt;1&lt;/span&gt; &lt;span style='color:#308080; '&gt;-&lt;/span&gt; s2&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;,&lt;/span&gt; &lt;span style='color:#008c00; '&gt;2&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt; &lt;span style='color:#308080; '&gt;/&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#008c00; '&gt;1&lt;/span&gt; &lt;span style='color:#308080; '&gt;+&lt;/span&gt; lightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;radialFalloff &lt;span style='color:#308080; '&gt;*&lt;/span&gt; s&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; frustumDistance &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;radius &lt;span style='color:#308080; '&gt;-&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;fabsf&lt;span style='color:#308080; '&gt;(&lt;/span&gt;Vector2&lt;span style='color:#406080; '&gt;::&lt;/span&gt;DotProduct&lt;span style='color:#308080; '&gt;(&lt;/span&gt;emissionTangent&lt;span style='color:#308080; '&gt;,&lt;/span&gt; ToPixel&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#200080; font-weight:bold; '&gt;if&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;frustumDistance &lt;span style='color:#308080; '&gt;&amp;lt;&lt;/span&gt; &lt;span style='color:#008000; '&gt;0.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    frustumDistance &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008000; '&gt;0.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;if&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;frustumDistance &lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt; radius&lt;span style='color:#308080; '&gt;)&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    frustumDistance &lt;span style='color:#308080; '&gt;=&lt;/span&gt; radius&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt;
    result &lt;span style='color:#308080; '&gt;=&lt;/span&gt; emitterDistance &lt;span style='color:#308080; '&gt;*&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;frustumDistance &lt;span style='color:#308080; '&gt;*&lt;/span&gt; lightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;frustumWeight&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt; &lt;span style='color:#200080; font-weight:bold; '&gt;break&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#e34adc; '&gt;        &lt;/span&gt;&lt;span style='color:#200080; font-weight:bold; '&gt;default&lt;/span&gt;&lt;span style='color:#e34adc; '&gt;:&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    assert&lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#308080; '&gt;!&lt;/span&gt;&lt;span style='color:#800000; '&gt;"&lt;/span&gt;&lt;span style='color:#1060b6; '&gt;Encountered a light source of an unknown type.&lt;/span&gt;&lt;span style='color:#800000; '&gt;"&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt; &lt;span style='color:#200080; font-weight:bold; '&gt;break&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt;

    &lt;span style='color:#595979; '&gt;//Do normal map calculations if light isnt pure dark&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;if&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;result &lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt; &lt;span style='color:#008c00; '&gt;0&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    &lt;span style='color:#595979; '&gt;//get normal maps "surface normal" from the r and g component of the normal buffer&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; normalR &lt;span style='color:#308080; '&gt;=&lt;/span&gt; normalBuffer&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;SampleColor&lt;span style='color:#308080; '&gt;(&lt;/span&gt;x&lt;span style='color:#308080; '&gt;,&lt;/span&gt; y&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;.&lt;/span&gt;r&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; normalG &lt;span style='color:#308080; '&gt;=&lt;/span&gt; normalBuffer&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;SampleColor&lt;span style='color:#308080; '&gt;(&lt;/span&gt;x&lt;span style='color:#308080; '&gt;,&lt;/span&gt; y&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;.&lt;/span&gt;g&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#595979; '&gt;//if surface is facing camera return early as the normal has no effect on the light here&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;if&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;normalR &lt;span style='color:#308080; '&gt;=&lt;/span&gt;&lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008c00; '&gt;0&lt;/span&gt; &lt;span style='color:#308080; '&gt;&amp;amp;&lt;/span&gt;&lt;span style='color:#308080; '&gt;&amp;amp;&lt;/span&gt; normalG &lt;span style='color:#308080; '&gt;=&lt;/span&gt;&lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008c00; '&gt;0&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;return&lt;/span&gt; result&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt;

    &lt;span style='color:#595979; '&gt;//calculate the normals effect on current pixel&lt;/span&gt;
    Vector2 pos &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;Vector2&lt;span style='color:#308080; '&gt;(&lt;/span&gt;x&lt;span style='color:#308080; '&gt;,&lt;/span&gt; y&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    Vector2 distFromLight &lt;span style='color:#308080; '&gt;=&lt;/span&gt; lightP &lt;span style='color:#308080; '&gt;-&lt;/span&gt; pos&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    Vector2 distNormalized &lt;span style='color:#308080; '&gt;=&lt;/span&gt; distFromLight&lt;span style='color:#308080; '&gt;.&lt;/span&gt;Normalize&lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    Vector2 normalDir &lt;span style='color:#308080; '&gt;=&lt;/span&gt; Vector2&lt;span style='color:#406080; '&gt;{&lt;/span&gt;normalR &lt;span style='color:#308080; '&gt;*&lt;/span&gt; ONE_OVER_255&lt;span style='color:#308080; '&gt;,&lt;/span&gt; normalG &lt;span style='color:#308080; '&gt;*&lt;/span&gt; ONE_OVER_255&lt;span style='color:#406080; '&gt;}&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    normalDir &lt;span style='color:#308080; '&gt;*&lt;/span&gt;&lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008c00; '&gt;2&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    normalDir &lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;=&lt;/span&gt; Vector2&lt;span style='color:#406080; '&gt;{&lt;/span&gt;&lt;span style='color:#008c00; '&gt;1&lt;/span&gt;&lt;span style='color:#308080; '&gt;,&lt;/span&gt; &lt;span style='color:#008c00; '&gt;1&lt;/span&gt;&lt;span style='color:#406080; '&gt;}&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; normalFalloff &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#308080; '&gt;-&lt;/span&gt;Vector2&lt;span style='color:#406080; '&gt;::&lt;/span&gt;DotProduct&lt;span style='color:#308080; '&gt;(&lt;/span&gt;distNormalized&lt;span style='color:#308080; '&gt;,&lt;/span&gt; normalDir&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    normalFalloff &lt;span style='color:#308080; '&gt;+&lt;/span&gt;&lt;span style='color:#308080; '&gt;=&lt;/span&gt; normalMin&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    normalFalloff &lt;span style='color:#308080; '&gt;=&lt;/span&gt; clamp&lt;span style='color:#308080; '&gt;(&lt;/span&gt;normalFalloff&lt;span style='color:#308080; '&gt;,&lt;/span&gt; &lt;span style='color:#008000; '&gt;0.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#308080; '&gt;,&lt;/span&gt; &lt;span style='color:#008000; '&gt;1.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    result &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;normalFalloff &lt;span style='color:#308080; '&gt;*&lt;/span&gt; normalStrength &lt;span style='color:#308080; '&gt;*&lt;/span&gt; result&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt;

    &lt;span style='color:#200080; font-weight:bold; '&gt;return&lt;/span&gt; result&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt;

    &lt;span style='color:#595979; '&gt;//Loop over every pixel and calculate each pixels rgb value&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;void&lt;/span&gt; Renderer&lt;span style='color:#406080; '&gt;::&lt;/span&gt;RenderLightingPass&lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;const&lt;/span&gt; &lt;span style='color:#200080; font-weight:bold; '&gt;int&lt;/span&gt; xSize &lt;span style='color:#308080; '&gt;=&lt;/span&gt; outputBuffer&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;size&lt;span style='color:#308080; '&gt;.&lt;/span&gt;x&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;const&lt;/span&gt; &lt;span style='color:#200080; font-weight:bold; '&gt;int&lt;/span&gt; ySize &lt;span style='color:#308080; '&gt;=&lt;/span&gt; outputBuffer&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;size&lt;span style='color:#308080; '&gt;.&lt;/span&gt;y&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; lightMultiplier &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008000; '&gt;0.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; intensityR &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008000; '&gt;0.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; intensityG &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008000; '&gt;0.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; intensityB &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008000; '&gt;0.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#595979; '&gt;//create a threadpool&lt;/span&gt;
    &lt;span style='color:#004a43; '&gt;#&lt;/span&gt;&lt;span style='color:#004a43; font-weight:bold; '&gt;pragma&lt;/span&gt;&lt;span style='color:#7779bb; font-weight:bold; '&gt; omp parallel&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    &lt;span style='color:#595979; '&gt;//create tasks for threads, make each take one index of the next three loops,&lt;/span&gt;
    &lt;span style='color:#595979; '&gt;//dont have them wait for other threads to finish, assign private variables&lt;/span&gt;
    &lt;span style='color:#004a43; '&gt;#&lt;/span&gt;&lt;span style='color:#004a43; font-weight:bold; '&gt;pragma&lt;/span&gt;&lt;span style='color:#7779bb; font-weight:bold; '&gt; omp for collapse(3) nowait private(lightMultiplier, intensityR, intensityG, intensityB)&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;for&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#200080; font-weight:bold; '&gt;int&lt;/span&gt; x &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008c00; '&gt;0&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt; x &lt;span style='color:#308080; '&gt;&amp;lt;&lt;/span&gt; xSize&lt;span style='color:#406080; '&gt;;&lt;/span&gt; &lt;span style='color:#308080; '&gt;+&lt;/span&gt;&lt;span style='color:#308080; '&gt;+&lt;/span&gt;x&lt;span style='color:#308080; '&gt;)&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;for&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#200080; font-weight:bold; '&gt;int&lt;/span&gt; y &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008c00; '&gt;0&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt; y &lt;span style='color:#308080; '&gt;&amp;lt;&lt;/span&gt; ySize&lt;span style='color:#406080; '&gt;;&lt;/span&gt; &lt;span style='color:#308080; '&gt;+&lt;/span&gt;&lt;span style='color:#308080; '&gt;+&lt;/span&gt;y&lt;span style='color:#308080; '&gt;)&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    intensityR &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008000; '&gt;0.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    intensityG &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008000; '&gt;0.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    intensityB &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008000; '&gt;0.0&lt;/span&gt;&lt;span style='color:#006600; '&gt;f&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#200080; font-weight:bold; '&gt;for&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#200080; font-weight:bold; '&gt;int&lt;/span&gt; i &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008c00; '&gt;0&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt; i &lt;span style='color:#308080; '&gt;&amp;lt;&lt;/span&gt; numLights&lt;span style='color:#406080; '&gt;;&lt;/span&gt; &lt;span style='color:#308080; '&gt;+&lt;/span&gt;&lt;span style='color:#308080; '&gt;+&lt;/span&gt;i&lt;span style='color:#308080; '&gt;)&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    &lt;span style='color:#595979; '&gt;//see if pixel is lit before running expensive lighting calculations&lt;/span&gt;
    &lt;span style='color:#595979; '&gt;//this saves time over running lighting calculations on unlit pixels&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;if&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;CalculateIfPixelIsLit&lt;span style='color:#308080; '&gt;(&lt;/span&gt;x&lt;span style='color:#308080; '&gt;,&lt;/span&gt; y&lt;span style='color:#308080; '&gt;,&lt;/span&gt; i&lt;span style='color:#308080; '&gt;)&lt;/span&gt; &lt;span style='color:#308080; '&gt;=&lt;/span&gt;&lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#200080; font-weight:bold; '&gt;true&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    Light&lt;span style='color:#308080; '&gt;*&lt;/span&gt; lightSource &lt;span style='color:#308080; '&gt;=&lt;/span&gt; lightSource &lt;span style='color:#308080; '&gt;+&lt;/span&gt; i&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    lightMultiplier &lt;span style='color:#308080; '&gt;=&lt;/span&gt; FindPixelLuminosity&lt;span style='color:#308080; '&gt;(&lt;/span&gt;x&lt;span style='color:#308080; '&gt;,&lt;/span&gt; y&lt;span style='color:#308080; '&gt;,&lt;/span&gt; lightSource&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#200080; font-weight:bold; '&gt;if&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;lightMultiplier &lt;span style='color:#308080; '&gt;!&lt;/span&gt;&lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#008c00; '&gt;0&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;{&lt;/span&gt;
    &lt;span style='color:#595979; '&gt;//convert from 0 - 255 into 0 - 1&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; R_F32 &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;lightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;color&lt;span style='color:#308080; '&gt;.&lt;/span&gt;GetRed&lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt; &lt;span style='color:#308080; '&gt;*&lt;/span&gt; ONE_OVER_255&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; G_F32 &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;lightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;color&lt;span style='color:#308080; '&gt;.&lt;/span&gt;GetGreen&lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt; &lt;span style='color:#308080; '&gt;*&lt;/span&gt; ONE_OVER_255&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#200080; font-weight:bold; '&gt;float&lt;/span&gt; B_F32 &lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;lightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;color&lt;span style='color:#308080; '&gt;.&lt;/span&gt;GetBlue&lt;span style='color:#308080; '&gt;(&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#308080; '&gt;)&lt;/span&gt; &lt;span style='color:#308080; '&gt;*&lt;/span&gt; ONE_OVER_255&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#595979; '&gt;//multiply by volumetric intesity to simulate fog&lt;/span&gt;
    &lt;span style='color:#595979; '&gt;//this lets you see the light beam itself&lt;/span&gt;
    lightMultiplier &lt;span style='color:#308080; '&gt;*&lt;/span&gt;&lt;span style='color:#308080; '&gt;=&lt;/span&gt; LightSource&lt;span style='color:#308080; '&gt;-&lt;/span&gt;&lt;span style='color:#308080; '&gt;&gt;&lt;/span&gt;volumetricIntensity&lt;span style='color:#406080; '&gt;;&lt;/span&gt;

    &lt;span style='color:#595979; '&gt;//multiply the intensity of the light by the underlying pixel color&lt;/span&gt;
    intensityR &lt;span style='color:#308080; '&gt;+&lt;/span&gt;&lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;lightMultiplier &lt;span style='color:#308080; '&gt;*&lt;/span&gt; R_F32&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    intensityG &lt;span style='color:#308080; '&gt;+&lt;/span&gt;&lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;lightMultiplier &lt;span style='color:#308080; '&gt;*&lt;/span&gt; G_F32&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    intensityB &lt;span style='color:#308080; '&gt;+&lt;/span&gt;&lt;span style='color:#308080; '&gt;=&lt;/span&gt; &lt;span style='color:#308080; '&gt;(&lt;/span&gt;lightMultiplier &lt;span style='color:#308080; '&gt;*&lt;/span&gt; B_F32&lt;span style='color:#308080; '&gt;)&lt;/span&gt;&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt;

    &lt;span style='color:#595979; '&gt;//store result in pixel array&lt;/span&gt;
    lightR&lt;span style='color:#308080; '&gt;[&lt;/span&gt;x&lt;span style='color:#308080; '&gt;]&lt;/span&gt;&lt;span style='color:#308080; '&gt;[&lt;/span&gt;y&lt;span style='color:#308080; '&gt;]&lt;/span&gt; &lt;span style='color:#308080; '&gt;=&lt;/span&gt; intensityR&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    lightG&lt;span style='color:#308080; '&gt;[&lt;/span&gt;x&lt;span style='color:#308080; '&gt;]&lt;/span&gt;&lt;span style='color:#308080; '&gt;[&lt;/span&gt;y&lt;span style='color:#308080; '&gt;]&lt;/span&gt; &lt;span style='color:#308080; '&gt;=&lt;/span&gt; intensityG&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    lightB&lt;span style='color:#308080; '&gt;[&lt;/span&gt;x&lt;span style='color:#308080; '&gt;]&lt;/span&gt;&lt;span style='color:#308080; '&gt;[&lt;/span&gt;y&lt;span style='color:#308080; '&gt;]&lt;/span&gt; &lt;span style='color:#308080; '&gt;=&lt;/span&gt; intensityB&lt;span style='color:#406080; '&gt;;&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt;
    &lt;span style='color:#406080; '&gt;}&lt;/span&gt;
    &lt;!--Created using ToHTML.com on 2025-01-27 23:04:59 UTC --&gt;
</code></pre>
							</p>
							<p></p>
						</div>
					</section>

			</div>

		<!-- Footer -->
			<footer id="footer" class="wrapper alt">
				<div class="inner">
					<ul class="menu">
						<li>&copy; Tyler Dean. All rights reserved.</li><li>Base Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>
				</div>
			</footer>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>